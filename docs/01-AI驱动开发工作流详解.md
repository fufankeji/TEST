# AI 驱动开发工作流详解

> 让 AI 自动管理你的代码提交和项目进度

---

## 一、这套工作流解决什么问题？

### 传统开发的痛点

| 痛点 | 描述 |
|------|------|
| 任务管理割裂 | 代码在编辑器，任务在另一个系统比如Linear、Jira、Trello等，两边手动同步 |
| Commit 不规范 | 随便写 "fix bug"、"update"，后期无法追溯 |
| 进度不透明 | 做了什么、做到哪了，需要手动汇报 |
| 上下文切换 | 写代码 → 切到浏览器更新任务 → 切回来继续写 |

### AI 驱动开发的解决方案

```
你说话 ──→ AI 理解 ──→ 自动执行

"开始做登录功能"
     ↓
┌─────────────────────────────────────────────────┐
│  Linear: 任务状态 → In Progress                  │
│  Git: 告知推荐分支名                             │
│  提示: 显示任务详情和验收标准                     │
└─────────────────────────────────────────────────┘

"完成了"
     ↓
┌─────────────────────────────────────────────────┐
│  Linear: 任务状态 → Done                         │
│  Git: 生成规范的 commit message                  │
│  提示: 是否提交并推送代码？                       │
└─────────────────────────────────────────────────┘
```

**核心价值：说人话，AI 帮你完成所有机械操作。**

### 完整操作流程概览

```
┌─────────────────────────────────────────────────────────────┐
│                     一次性配置                               │
├─────────────────────────────────────────────────────────────┤
│ 1. Cursor 连接 Linear MCP，完成授权                          │
│ 2. 在 Linear 创建 Team（团队），设置 Key（如 AUTH）           │
│ 3. 创建 GitHub 仓库（可选，但推荐）                          │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                     每个新项目                               │
├─────────────────────────────────────────────────────────────┤
│ 4. 复制 .cursorrules 到项目根目录，修改项目名和团队名         │
│ 5. 对 AI 说"创建项目 XXX"                                    │
│    → AI 在 Linear 创建 Project + Issues                      │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                     日常开发                                 │
├─────────────────────────────────────────────────────────────┤
│ 6. 说"开始做 AUTH-1" 或 "做用户登录" 或 "做 Phase 1"         │
│    → AI 自动匹配并更新状态为 In Progress                     │
│ 7. 开发代码...                                              │
│ 8. 说"提交代码" → AI 执行 git add + commit + push            │
│ 9. 说"完成了" → AI 自动完成当前任务，更新状态为 Done          │
└─────────────────────────────────────────────────────────────┘
```

> ⚠️ **注意**：Linear 状态不是全自动同步的，需要你"说话"触发 AI 执行操作。
> 唯一的"全自动"：配置 GitHub 集成后，PR 合并会自动关闭关联的 Issue。

### 智能任务匹配

你不需要记住 Issue ID，可以用任务描述来开始任务：

| 你说的话 | AI 执行 |
|---------|---------|
| "开始做 AUTH-1" | 直接更新 AUTH-1 |
| "做用户登录" | 查询 Linear，找到匹配的任务并更新 |
| "开始做 Phase 1" | 根据 Plan 上下文匹配对应任务 |
| "完成了" | 自动完成**当前正在进行的任务** |

**工作原理：**
```
用户：做用户登录
     ↓
AI 调用 list_issues 查询项目任务
     ↓
匹配到 AUTH-1「[用户] 实现登录功能」
     ↓
调用 update_issue 将 AUTH-1 → In Progress
     ↓
AI 记录：当前任务 = AUTH-1
     ↓
用户：完成了
     ↓
AI 检测到当前任务 AUTH-1，自动完成
```

---

## 二、技术架构

### 工具链

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Cursor    │────▶│   Linear    │────▶│   GitHub    │
│  AI 编辑器  │ MCP │  项目管理   │ 集成 │  代码托管   │
└─────────────┘     └─────────────┘     └─────────────┘
       │                   │                   │
       └───────────────────┴───────────────────┘
                     .cursorrules
                    (规则配置文件)
```

### 各组件职责

| 组件 | 职责 |
|------|------|
| **Cursor** | AI 代码编辑器，理解自然语言指令 |
| **Linear MCP** | 让 Cursor 能调用 Linear API |
| **Linear** | 项目管理，看板、任务、进度追踪 |
| **.cursorrules** | 定义 AI 的行为规范 |
| **GitHub** | 代码托管，与 Linear 集成后可自动关联 |

### MCP 是什么？

MCP（Model Context Protocol）是让 AI 调用外部工具的协议。

```
用户："开始做 AUTH-1"
        ↓
Cursor AI 理解意图
        ↓
调用 Linear MCP
        ↓
Linear API: 更新 Issue 状态
        ↓
返回结果给用户
```

---

## 三、Linear 核心概念

### 层级结构

```
Workspace（工作区）
│
├── Team（团队）           ← Issue ID 的前缀在这里设置
│   │   Key: AUTH
│   │
│   ├── Project（项目）    ← 项目只是分组容器
│   │   └── 用户认证系统
│   │
│   └── Issues（任务）     ← ID = 团队Key + 序号
│       ├── AUTH-1: 登录功能
│       ├── AUTH-2: 注册功能
│       └── AUTH-3: 密码重置
│
└── Team（另一个团队）
    │   Key: SHOP
    │
    └── Issues
        ├── SHOP-1
        └── SHOP-2
```

### Issue ID 规则

```
Issue ID = 团队 Key + 自增序号

团队 Key: AUTH  →  AUTH-1, AUTH-2, AUTH-3...
团队 Key: SHOP  →  SHOP-1, SHOP-2, SHOP-3...
```

**重点：Issue ID 跟着团队走，不是项目！**

### 什么是 Team Key（Identifier）？

**Team Key** 是 Linear 团队的唯一标识符，由 2-5 个大写字母组成，决定了该团队下所有 Issue 的 ID 前缀。

| Team Key | 生成的 Issue ID |
|----------|----------------|
| `AUTH` | AUTH-1, AUTH-2, AUTH-3... |
| `SHOP` | SHOP-1, SHOP-2, SHOP-3... |
| `BLOG` | BLOG-1, BLOG-2, BLOG-3... |

**如何设置 Team Key？**

1. **创建团队时**：Linear 会要求你填写 Identifier
2. **修改已有团队**：
   - 点击左侧团队名 → Settings（齿轮图标）
   - 找到 **Identifier** 字段
   - 修改为你想要的 Key

**为什么 Key 很重要？**

Issue ID 会出现在多个地方：
- 分支名：`feature/AUTH-1-user-login`
- Commit：`feat(auth): 登录功能 AUTH-1`
- PR 关联：`Closes AUTH-1`

所以建议设置**简短、有意义、专业**的 Key。

**推荐的 Key 命名：**

| 项目类型 | 推荐 Key |
|----------|----------|
| 认证系统 | AUTH |
| 电商平台 | SHOP |
| 博客系统 | BLOG |
| 管理后台 | ADMIN |
| API 服务 | API |

### 任务状态流转

```
┌────────┐     ┌─────────────┐     ┌────────┐
│  Todo  │────▶│ In Progress │────▶│  Done  │
└────────┘     └─────────────┘     └────────┘
                     │
                     ▼
               ┌──────────┐
               │ Canceled │
               └──────────┘
```

---

## 四、Git 规范

### 分支命名

```
<type>/<issue-id>-<description>
```

| 类型 | 用途 | 示例 |
|------|------|------|
| `feature/` | 新功能 | `feature/AUTH-1-user-login` |
| `fix/` | Bug 修复 | `fix/AUTH-5-login-error` |
| `hotfix/` | 紧急修复 | `hotfix/AUTH-10-security` |
| `docs/` | 文档 | `docs/AUTH-3-api-docs` |
| `refactor/` | 重构 | `refactor/AUTH-2-optimize` |

### Commit Message 规范

采用 [Conventional Commits](https://www.conventionalcommits.org/) 规范：

```
<type>(<scope>): <description> <issue-id>
```

| Type | 说明 | Emoji |
|------|------|-------|
| `feat` | 新功能 | ✨ |
| `fix` | Bug 修复 | 🐛 |
| `docs` | 文档 | 📝 |
| `style` | 格式/样式 | 💄 |
| `refactor` | 重构 | ♻️ |
| `perf` | 性能优化 | ⚡ |
| `test` | 测试 | ✅ |
| `chore` | 杂项/依赖 | 🔧 |

**示例：**

```
feat(auth): 实现用户登录功能 AUTH-1
fix(auth): 修复密码验证错误 AUTH-5
docs: 更新 API 接口文档 AUTH-3
```

---

## 五、.cursorrules 文件

### 作用

`.cursorrules` 是放在项目根目录的配置文件，定义 AI 的行为规范。

### 核心内容

1. **项目信息** - 项目名、团队名
2. **触发词映射** - 什么话触发什么动作
3. **Git 规范** - 分支和 Commit 格式
4. **输出格式** - AI 回复的标准格式

### 触发词映射表

| 你说 | AI 执行 |
|------|---------|
| "创建项目 XXX" | Linear: 创建 Project + Issues |
| "新建任务 XXX" | Linear: 创建 Issue |
| "开始做 `<ID>`" | Linear: Issue → In Progress |
| "完成了" / "搞定" | Linear: Issue → Done |
| "取消 `<ID>`" | Linear: Issue → Canceled |
| "列出任务" / "待办" | 显示任务列表 |
| "项目进度" | 显示完成百分比 |
| "提交代码" | Git: add + commit + push |
| "同步到 Linear" / "根据 plan 创建" | 读取 Plan MD，创建 Linear Project + Issues |

---

## 六、Plan 模式与 Linear 关联

### 什么是 Plan 模式？

Cursor 的 Plan 模式可以帮你规划项目结构，生成 MD 格式的项目计划文件。

### Plan + Linear 工作流

```
┌─────────────────────────────────────────────────────────────┐
│ 1. Plan 模式规划项目                                         │
│    "帮我规划一个电商系统"                                     │
│         ↓                                                   │
│    生成 plan.md 文件                                         │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 2. 切换到 Agent 模式                                         │
│    "根据 @plan.md 同步到 Linear"                             │
│         ↓                                                   │
│    AI 读取 plan.md → 创建 Linear Project + Issues            │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 3. 正常开发流程                                              │
│    "开始做 SHOP-1" → 开发 → "完成了"                          │
└─────────────────────────────────────────────────────────────┘
```

### 操作示例

**第 1 步：Plan 模式生成规划**

```
👤 你（Plan 模式）：帮我规划一个电商系统

🤖 AI 生成 plan.md：
# 电商系统

## 用户模块
- [ ] 用户注册（优先级：高）
- [ ] 用户登录（优先级：高）
- [ ] 个人中心（优先级：中）

## 商品模块
- [ ] 商品列表（优先级：高）
- [ ] 商品详情（优先级：高）
- [ ] 商品搜索（优先级：中）

## 订单模块
- [ ] 购物车（优先级：高）
- [ ] 下单流程（优先级：高）
- [ ] 订单管理（优先级：中）
```

**第 2 步：同步到 Linear**

```
👤 你（Agent 模式）：根据 @plan.md 同步到 Linear

🤖 AI：
✅ 已根据 Plan 创建项目：电商系统

📋 创建的任务：
| ID | 任务 | 模块 | 优先级 |
|----|------|------|--------|
| SHOP-1 | 用户注册 | 用户模块 | 🔴 High |
| SHOP-2 | 用户登录 | 用户模块 | 🔴 High |
| SHOP-3 | 个人中心 | 用户模块 | 🟡 Medium |
| SHOP-4 | 商品列表 | 商品模块 | 🔴 High |
| SHOP-5 | 商品详情 | 商品模块 | 🔴 High |
| SHOP-6 | 商品搜索 | 商品模块 | 🟡 Medium |
| SHOP-7 | 购物车 | 订单模块 | 🔴 High |
| SHOP-8 | 下单流程 | 订单模块 | 🔴 High |
| SHOP-9 | 订单管理 | 订单模块 | 🟡 Medium |

共 9 个任务，可以开始开发了！
```

### Plan 文件推荐格式

为了让 AI 更好地解析，建议 Plan 文件使用以下格式：

```markdown
# 项目名称

## 模块A
- [ ] 任务1（优先级：高）
- [ ] 任务2（优先级：中）
- [ ] 任务3（优先级：低）

## 模块B
- [ ] 任务4（优先级：高）
- [ ] 任务5
```

**优先级标记方式**（以下都能识别）：
- `（优先级：高）` / `（优先级：中）` / `（优先级：低）`
- `[高]` / `[中]` / `[低]`
- `P0` / `P1` / `P2` / `P3`
- `urgent` / `high` / `medium` / `low`

---

## 七、完整工作流演示

### 场景：开发一个用户认证系统

**第 1 步：创建项目**

```
👤 你：帮我创建项目"用户认证系统"，包含登录、注册、密码重置三个功能

🤖 AI：
✅ 已创建项目：用户认证系统

📋 已创建任务：
| ID | 任务 | 优先级 |
|----|------|--------|
| AUTH-1 | 登录功能 | 🔴 High |
| AUTH-2 | 注册功能 | 🔴 High |
| AUTH-3 | 密码重置 | 🟡 Medium |
```

**第 2 步：领取任务**

```
👤 你：开始做 AUTH-1

🤖 AI：
✅ 已领取任务 AUTH-1

📌 任务：登录功能
📊 优先级：🔴 High

🌿 推荐分支：feature/AUTH-1-user-login
💡 是否需要我创建分支？
```

**第 3 步：开发过程中提交**

```
👤 你：提交一下当前代码

🤖 AI：
📝 检测到更改：
- 新增 src/auth/login.js
- 修改 src/router.js

推荐 commit:
feat(auth): 添加登录页面路由 AUTH-1

✅ 已提交并推送
```

**第 4 步：完成任务**

```
👤 你：AUTH-1 完成了

🤖 AI：
✅ 任务 AUTH-1 已完成！

📝 最终 Commit:
feat(auth): 完成用户登录功能 AUTH-1

✅ Linear 状态已更新为 Done
✅ 代码已推送

🎉 进度：33% (1/3)，下一个任务？
```

**第 5 步：查看进度**

```
👤 你：项目进度

🤖 AI：
📊 用户认证系统

完成度：███░░░░░░░ 33%

| ID | 任务 | 状态 |
|----|------|------|
| AUTH-1 | 登录功能 | ✅ Done |
| AUTH-2 | 注册功能 | ⬜ Todo |
| AUTH-3 | 密码重置 | ⬜ Todo |
```

---

## 八、两种更新 Linear 状态的方式

### 方式对比

| 方式 | 触发条件 | 状态更新时机 | 适合场景 |
|------|----------|-------------|----------|
| **方式1：说话触发** | 说"完成了" | 立即更新 | 个人开发、快速迭代 |
| **方式2：GitHub 集成** | PR 合并 | 合并后自动更新 | 团队协作、代码审查 |

### 方式1：说话触发（推荐个人开发）

```
开发完成
    ↓
说"完成了"
    ↓
AI 调用 Linear API → 状态立即变成 Done
    ↓
代码可以之后再合并，或者直接在 main 分支开发
```

**优点**：简单快速，不需要等 PR 流程
**适合**：个人项目、快速原型、学习练习

### 方式2：GitHub 集成（推荐团队协作）

```
在功能分支开发（如 feature/AUTH-1-login）
    ↓
提交代码，推送到 GitHub
    ↓
创建 PR，描述中写 "Closes AUTH-1"
    ↓
团队成员代码审查
    ↓
PR 合并 → Linear Issue 自动变成 Done
```

**优点**：有代码审查流程，更规范
**注意**：必须等 PR 合并后状态才会更新

### 场景建议

| 场景 | 推荐方式 |
|------|----------|
| 个人项目 | 方式1：说"完成了"直接更新 |
| 团队协作 | 方式2：通过 PR 合并自动更新 |
| 学习练习 | 方式1：简单快速 |
| 正式项目 | 方式2：规范流程 |

### 混合使用

也可以两种方式结合：
1. 开发完成后说"完成了"更新状态
2. 之后再创建 PR 进行代码审查
3. PR 合并（此时 Issue 已经是 Done，不会重复更新）

---

## 九、GitHub 集成配置（可选）

如果选择方式2，需要配置 GitHub 集成：

### 配置后可实现

1. **PR 自动关联 Issue** - PR 描述写 `Closes AUTH-1`
2. **合并后自动完成** - PR 合并 → Issue 自动变 Done
3. **分支自动关联** - 使用 Linear 生成的分支名

### 配置步骤

**第 1 步：进入 GitHub 集成设置**

1. 打开 Linear
2. 点击左侧菜单 **「Integrations」**（在 Features 区域下）
3. 找到 **GitHub** 并点击进入

**第 2 步：连接 GitHub 账户**

1. 点击 **Connect** 连接你的 GitHub
2. 授权 Linear 访问
3. 选择要关联的 Organization（组织）

**第 3 步：开启关键选项**

在 GitHub 集成页面，找到并**开启**以下选项：

| 选项 | 位置 | 作用 |
|------|------|------|
| **Link commits to issues with magic words** | 页面底部 | ⭐ 核心功能！开启后 PR 合并自动关闭 Issue |
| **Public repositories** | Linkbacks 区域 | 支持公开仓库的关联 |
| **Private repositories** | Linkbacks 区域 | 支持私有仓库的关联 |

> ⚠️ **重要**：「Link commits to issues with magic words」默认是关闭的，必须手动开启！

**第 4 步：验证配置**

开启后，在 commit message 或 PR 描述中使用以下关键词：

| 关键词 | 效果 |
|--------|------|
| `Fixes AUTH-1` | PR 合并后 Issue 自动关闭 |
| `Closes AUTH-1` | PR 合并后 Issue 自动关闭 |
| `Part of AUTH-1` | 关联 Issue 但不自动关闭 |

### 其他可选配置

| 选项 | 说明 |
|------|------|
| **Branch format** | 设置分支命名格式，默认 `username/identifier-title` |
| **Linkbacks** | 自动在 GitHub PR/commit 中评论 Linear issue 链接 |
| **GitHub Issues** | 从 GitHub Issues 同步到 Linear（一般不需要）|

---

## 十、常见问题

### Q: Issue ID 前缀可以自定义吗？

A: 可以。在 Linear Team Settings → Identifier 中修改团队 Key。

### Q: 一定要用 Linear 吗？

A: 这套流程基于 Linear MCP，暂不支持其他工具。

### Q: 没网络时能用吗？

A: Git 本地操作可以，但 Linear 状态同步需要网络。

### Q: 多人协作怎么办？

A: 每人领取不同任务，各自在独立分支开发，通过 PR 合并。
